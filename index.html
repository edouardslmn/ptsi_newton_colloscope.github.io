<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Colloscope PTSI 2025-2026</title>
<style>
:root{--bg:#0a0a0f;--bg2:#12121a;--card:rgba(255,255,255,.03);--card-h:rgba(255,255,255,.06);--border:rgba(255,255,255,.08);--txt:#fff;--txt2:#a0a0b0;--txt3:#606070;--blue:#3b82f6;--purple:#8b5cf6;--green:#10b981;--red:#ef4444;--cyan:#06b6d4;--yellow:#eab308;--orange:#f97316}
[data-theme="light"]{--bg:#f8f9fc;--bg2:#fff;--card:rgba(0,0,0,.02);--card-h:rgba(0,0,0,.04);--border:rgba(0,0,0,.08);--txt:#1a1a2e;--txt2:#4a4a5a;--txt3:#8a8a9a}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:system-ui,sans-serif;background:var(--bg);color:var(--txt);min-height:100vh}
.c{max-width:1400px;margin:0 auto;padding:0 20px}
header{padding:16px 0;position:sticky;top:0;z-index:100;background:var(--bg);border-bottom:1px solid var(--border)}
.hd{display:flex;justify-content:space-between;align-items:center}
.logo{font-size:1.4rem;font-weight:700;background:linear-gradient(135deg,var(--blue),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.ha{display:flex;align-items:center;gap:10px}
.tb{width:40px;height:40px;border-radius:10px;border:1px solid var(--border);background:var(--card);cursor:pointer;font-size:1.1rem}
.ub{display:none;align-items:center;gap:8px;padding:5px 12px 5px 5px;background:var(--card);border:1px solid var(--border);border-radius:50px;cursor:pointer}
.ua{width:28px;height:28px;border-radius:50%;background:linear-gradient(135deg,var(--blue),var(--purple));display:flex;align-items:center;justify-content:center;font-weight:600;font-size:.75rem;color:#fff}
.un{font-weight:500;font-size:.85rem}
.ug{font-size:.7rem;color:var(--txt3)}
.lb{display:none;background:none;border:none;color:var(--txt3);cursor:pointer;padding:6px;font-size:1rem}
.ws{min-height:calc(100vh - 80px);display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;text-align:center}
.ws.h{display:none}
.wt{font-size:clamp(2rem,5vw,3rem);font-weight:800;margin-bottom:10px}
.wt .g{background:linear-gradient(135deg,var(--blue),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.wst{font-size:.95rem;color:var(--txt2);margin-bottom:36px}
.ss{width:100%;max-width:360px}
.sc{position:relative;margin-bottom:10px}
.si{width:100%;padding:14px 18px 14px 44px;font-size:.95rem;background:var(--card);border:1px solid var(--border);border-radius:12px;color:var(--txt)}
.si:focus{outline:none;border-color:var(--blue)}
.sic{position:absolute;left:16px;top:50%;transform:translateY(-50%);color:var(--txt3)}
.sl{background:var(--bg2);border:1px solid var(--border);border-radius:12px;max-height:280px;overflow-y:auto}
.sti{padding:12px 14px;cursor:pointer;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px}
.sti:hover{background:var(--card-h)}
.sta{width:34px;height:34px;border-radius:8px;background:linear-gradient(135deg,var(--blue),var(--purple));display:flex;align-items:center;justify-content:center;font-weight:600;font-size:.75rem;color:#fff}
.stn{font-weight:500;font-size:.9rem}
.stg{font-size:.7rem;color:var(--txt3)}
.db{padding:24px 0 50px;display:none}
.db.a{display:block}
.prog-wrap{margin-bottom:20px}
.prog-info{display:flex;justify-content:space-between;font-size:.8rem;color:var(--txt2);margin-bottom:8px}
.prog-bar{height:8px;background:var(--card);border-radius:4px;overflow:hidden}
.prog-fill{height:100%;background:linear-gradient(90deg,var(--blue),var(--purple));border-radius:4px}
.wh{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:14px}
.wi h2{font-size:1.4rem;font-weight:700;margin-bottom:3px}
.wi p{color:var(--txt2);font-size:.85rem}
.wn{display:flex;gap:6px}
.wb{padding:9px 16px;border-radius:9px;border:1px solid var(--border);background:var(--card);color:var(--txt);font-size:.8rem;font-weight:500;cursor:pointer}
.wb:hover{background:var(--card-h)}
.wb.a{background:linear-gradient(135deg,var(--blue),var(--purple));border-color:transparent;color:#fff}
.acts{display:flex;gap:8px;margin-bottom:20px;flex-wrap:wrap}
.act{display:flex;align-items:center;gap:6px;padding:8px 14px;border-radius:8px;border:1px solid var(--border);background:var(--card);color:var(--txt);font-size:.8rem;cursor:pointer}
.act:hover{background:var(--card-h)}
.dsb{background:linear-gradient(135deg,rgba(139,92,246,.1),rgba(139,92,246,.03));border:1px solid rgba(139,92,246,.2);border-radius:12px;padding:14px 18px;margin-bottom:20px;display:flex;align-items:center;gap:12px}
.dsbi{width:38px;height:38px;border-radius:9px;background:rgba(139,92,246,.12);display:flex;align-items:center;justify-content:center;font-size:1.2rem}
.dsb h3{font-weight:600;color:#8b5cf6;margin-bottom:2px;font-size:.9rem}
.dsb p{color:var(--txt2);font-size:.8rem}
.vb{background:linear-gradient(135deg,rgba(139,92,246,.1),rgba(236,72,153,.1));border:1px solid rgba(139,92,246,.2);border-radius:12px;padding:24px;text-align:center;margin-bottom:20px}
.vb h3{font-size:1.2rem;margin-bottom:5px}
.vb p{color:var(--txt2);font-size:.85rem}
.tabs{display:flex;gap:8px;margin-bottom:20px;flex-wrap:wrap}
.tab{padding:10px 20px;border-radius:10px;border:1px solid var(--border);background:var(--card);color:var(--txt);font-size:.85rem;font-weight:500;cursor:pointer}
.tab:hover{background:var(--card-h)}
.tab.a{background:linear-gradient(135deg,var(--blue),var(--purple));border-color:transparent;color:#fff}
.stt{font-size:1.1rem;font-weight:600;margin-bottom:16px;display:flex;align-items:center;gap:8px}
.stt:before{content:"";width:3px;height:18px;background:linear-gradient(135deg,var(--blue),var(--purple));border-radius:2px}
.cg{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:14px;margin-bottom:32px}
.cc{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:20px;position:relative;overflow:hidden}
.cc:before{content:"";position:absolute;top:0;left:0;right:0;height:3px;background:var(--ca)}
.cc.ma{--ca:#3b82f6}.cc.ph{--ca:#eab308}.cc.si{--ca:#ef4444}.cc.an{--ca:#f97316}.cc.fr{--ca:#06b6d4}
.cs{font-size:1.05rem;font-weight:600;margin-bottom:14px;display:flex;align-items:center;gap:10px}
.csi{width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:1.1rem}
.cc.ma .csi{background:rgba(59,130,246,.15)}.cc.ph .csi{background:rgba(234,179,8,.15)}.cc.si .csi{background:rgba(239,68,68,.15)}.cc.an .csi{background:rgba(249,115,22,.15)}.cc.fr .csi{background:rgba(6,182,212,.15)}
.cd{display:flex;flex-direction:column;gap:10px}
.cdi{display:flex;align-items:center;gap:10px;color:var(--txt2);font-size:.9rem}
.cdic{width:28px;height:28px;border-radius:6px;background:var(--card-h);display:flex;align-items:center;justify-content:center;font-size:.85rem}
.nc{text-align:center;padding:40px;color:var(--txt3);background:var(--card);border-radius:16px;border:1px dashed var(--border);grid-column:1/-1}
.nci{font-size:2.5rem;margin-bottom:12px;opacity:.5}
.tc{display:none}.tc.a{display:block}
.edt{overflow-x:auto;background:var(--card);border:1px solid var(--border);border-radius:16px;padding:12px}
.edt table{width:100%;min-width:900px;border-collapse:collapse}
.edt th{padding:10px 8px;border:1px solid var(--border);background:var(--card-h);font-weight:600;text-align:center}
.edt th.today{background:linear-gradient(135deg,rgba(59,130,246,.2),rgba(139,92,246,.2));color:var(--blue)}
.edt td{border:1px solid var(--border);vertical-align:top;padding:0;position:relative}
.edt td.today{background:rgba(59,130,246,.05)}
.edt .time{width:80px;font-size:.75rem;color:var(--txt3);text-align:center;font-weight:500;padding:8px}
.edt-item{border-radius:6px;padding:8px 10px;margin:2px;font-size:.75rem;position:absolute;left:2px;right:2px;overflow:hidden}
.edt-item.ma{background:rgba(59,130,246,.25);border-left:3px solid #3b82f6}
.edt-item.ph{background:rgba(234,179,8,.25);border-left:3px solid #eab308}
.edt-item.si{background:rgba(239,68,68,.25);border-left:3px solid #ef4444}
.edt-item.an{background:rgba(249,115,22,.25);border-left:3px solid #f97316}
.edt-item.fr{background:rgba(6,182,212,.25);border-left:3px solid #06b6d4}
.edt-item.in{background:rgba(236,72,153,.25);border-left:3px solid #ec4899}
.edt-item.ti{background:rgba(107,114,128,.25);border-left:3px solid #6b7280}
.edt-item.co{background:rgba(16,185,129,.25);border-left:3px solid #10b981}
.edt-item.ds{background:rgba(139,92,246,.25);border-left:3px solid #8b5cf6}
.edt-item .n{font-weight:600;margin-bottom:2px}
.edt-item .i{font-size:.65rem;color:var(--txt2)}
.contact-section{margin-bottom:30px}
.contact-section h4{font-size:1rem;font-weight:600;margin-bottom:12px}
.contact-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:12px}
.contact-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;display:flex;align-items:center;gap:14px}
.contact-card:hover{background:var(--card-h)}
.contact-avatar{width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.2rem}
.contact-avatar.ma{background:rgba(59,130,246,.15)}.contact-avatar.ph{background:rgba(234,179,8,.15)}.contact-avatar.si{background:rgba(239,68,68,.15)}.contact-avatar.an{background:rgba(249,115,22,.15)}.contact-avatar.fr{background:rgba(6,182,212,.15)}
.contact-name{font-weight:600;font-size:.9rem;margin-bottom:4px}
.contact-email a{color:var(--blue);text-decoration:none;font-size:.8rem}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:14px;margin-bottom:24px}
.stat-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px;text-align:center}
.stat-value{font-size:2rem;font-weight:700;background:linear-gradient(135deg,var(--blue),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.stat-label{font-size:.8rem;color:var(--txt2);margin-top:4px}
.grades-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:14px}
.grade-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px}
.grade-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
.grade-subject{font-weight:600;display:flex;align-items:center;gap:8px}
.grade-avg{font-size:1.2rem;font-weight:700}
.grade-list{display:flex;flex-direction:column;gap:8px}
.grade-item{display:flex;align-items:center;justify-content:space-between;padding:8px 12px;background:var(--card-h);border-radius:8px;font-size:.85rem}
.add-grade-btn{width:100%;padding:10px;border:1px dashed var(--border);border-radius:8px;background:transparent;color:var(--txt3);cursor:pointer;margin-top:8px}
.add-grade-btn:hover{background:var(--card-h);color:var(--txt)}
.compare-select select{width:100%;max-width:300px;padding:12px;border:1px solid var(--border);border-radius:10px;background:var(--card);color:var(--txt);font-size:.9rem;margin-bottom:16px}
.compare-result{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px;margin-top:20px;display:none}
.free-slots{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:10px;margin-top:16px}
.free-slot{background:rgba(16,185,129,.1);border:1px solid rgba(16,185,129,.2);border-radius:8px;padding:12px;text-align:center}
.free-slot .day{font-weight:600;font-size:.9rem;margin-bottom:4px}
.free-slot .time{font-size:.8rem;color:var(--txt2)}
.memo-area{width:100%;min-height:150px;padding:16px;border:1px solid var(--border);border-radius:12px;background:var(--card);color:var(--txt);font-size:.9rem;resize:vertical}
.memo-area:focus{outline:none;border-color:var(--blue)}
.memo-saved{color:var(--green);font-size:.8rem;margin-top:8px;opacity:0;transition:opacity .3s}
.memo-saved.show{opacity:1}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:1000;align-items:center;justify-content:center;padding:20px}
.modal.show{display:flex}
.modal-content{background:var(--bg2);border:1px solid var(--border);border-radius:16px;padding:24px;max-width:500px;width:100%}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.modal-header h3{font-size:1.2rem}
.modal-close{background:none;border:none;color:var(--txt3);font-size:1.5rem;cursor:pointer}
.modal-input{width:100%;padding:12px;border:1px solid var(--border);border-radius:8px;background:var(--card);color:var(--txt);margin-bottom:12px}
@media(max-width:768px){.wh{flex-direction:column;align-items:flex-start}.contact-grid,.grades-grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<header><div class="c"><div class="hd">
<div class="logo">Colloscope PTSI - Newton</div>
<div class="ha">
<button class="tb" id="themeBtn">&#127769;</button>
<div class="ub" id="userBtn"><div class="ua" id="userAvatar">AB</div><div><div class="un" id="userName">-</div><div class="ug" id="userGroup">-</div></div></div>
<button class="lb" id="logoutBtn">&#128682;</button>
</div>
</div></div></header>
<main class="c">
<section class="ws" id="welcome">
<h1 class="wt">Bienvenue sur<br><span class="g">Colloscope PTSI - Newton</span></h1>
<p class="wst">Selectionne ton nom pour acceder a tes colles et ton emploi du temps</p>
<div class="ss">
<div class="sc"><span class="sic">&#128269;</span><input type="text" class="si" id="searchInput" placeholder="Rechercher..."></div>
<div class="sl" id="studentList"></div>
</div>
</section>
<section class="db" id="dashboard">
<div class="prog-wrap"><div class="prog-info"><span id="progText">Semaine 1/32</span><span id="progPct">3%</span></div><div class="prog-bar"><div class="prog-fill" id="progFill" style="width:3%"></div></div></div>
<div class="wh"><div class="wi"><h2 id="weekTitle">Semaine 1</h2><p id="weekDates">-</p></div><div class="wn"><button class="wb" id="prevBtn">&larr; Prec.</button><button class="wb a" id="todayBtn">Aujourd'hui</button><button class="wb" id="nextBtn">Suiv. &rarr;</button></div></div>
<div class="acts"><button class="act" id="notifBtn">&#128276; Rappels</button><button class="act" id="exportBtn">&#128197; Export .ics</button></div>
<div id="vacBanner"></div>
<div id="dsBanner"></div>
<div class="tabs" id="tabs"></div>
<div class="tc a" id="colleContent"><h3 class="stt">Mes colles</h3><div class="cg" id="colleGrid"></div></div>
<div class="tc" id="edtContent"><h3 class="stt">Mon emploi du temps</h3><div class="edt" id="edtGrid"></div></div>
<div class="tc" id="statsContent"><h3 class="stt">Statistiques</h3><div class="stats-grid" id="statsGrid"></div><h3 class="stt" style="margin-top:24px">Mes notes</h3><div class="grades-grid" id="gradesGrid"></div></div>
<div class="tc" id="compareContent"><h3 class="stt">Creneaux libres</h3><p style="color:var(--txt2);margin-bottom:16px;font-size:.9rem">Selectionne des camarades pour voir quand vous etes libres.</p><div class="compare-select"><select id="compareSelect" multiple style="height:150px"></select></div><button class="wb a" id="compareBtn">Comparer</button><div class="compare-result" id="compareResult"></div></div>
<div class="tc" id="notesContent"><h3 class="stt">Memo</h3><textarea class="memo-area" id="memoArea" placeholder="Notes pour cette semaine..."></textarea><div class="memo-saved" id="memoSaved">Sauvegarde</div></div>
<div class="tc" id="contactContent"><h3 class="stt">Contacts</h3><div id="contactGrid"></div></div>
</section>
</main>
<div class="modal" id="gradeModal"><div class="modal-content"><div class="modal-header"><h3>Ajouter note</h3><button class="modal-close" id="closeModal">&times;</button></div><input type="text" class="modal-input" id="gradeLabel" placeholder="Intitule (DS 1, Colle...)"><input type="number" class="modal-input" id="gradeValue" placeholder="Note /20" min="0" max="20" step="0.5"><button class="wb a" id="addGradeBtn" style="width:100%">Ajouter</button></div></div>
<script>
var S=[{n:"CAMPANA Matthieu",g:1,s:"a"},{n:"BALLESIO--VALLIN Mathis",g:1,s:"b"},{n:"BAU Baptiste",g:1,s:"c"},{n:"BECHET Alexis",g:2,s:"a"},{n:"BEJANI Yoann",g:2,s:"b"},{n:"BENALLEGUE Manel",g:2,s:"c"},{n:"BERGER Valentin",g:3,s:"a"},{n:"BOUATOU Yann",g:3,s:"b"},{n:"BOURGOUIN Matthieu",g:3,s:"c"},{n:"BRETON Perrine",g:4,s:"a"},{n:"BURNOD Arthur",g:4,s:"b"},{n:"CHAMEAU-CALMELS Pierre-Louis",g:4,s:"c"},{n:"CHOUAR Kenza",g:5,s:"a"},{n:"COCHARD Antoine",g:5,s:"b"},{n:"CONDOMINES Oscar",g:5,s:"c"},{n:"DABO Benjamin",g:6,s:"a"},{n:"DOMINGUES Alexandre",g:6,s:"b"},{n:"DUFAY Nicolas",g:6,s:"c"},{n:"FOUQUES DUPARC Maxence",g:7,s:"a"},{n:"FOURMAINTRAUX Paul",g:7,s:"b"},{n:"GENDRON Marius",g:7,s:"c"},{n:"GERVAIS Tom",g:8,s:"a"},{n:"GUIHENEUF Neil",g:8,s:"b"},{n:"GUILLO Antoine",g:8,s:"c"},{n:"GERMAGNAN Corentin",g:9,s:"a"},{n:"GUILLONNEAU Antoine",g:9,s:"b"},{n:"HERVE Louann",g:9,s:"c"},{n:"HIGUERA Esteban",g:10,s:"a"},{n:"HIRIART--LATROBE Hadrien",g:10,s:"b"},{n:"HORINOUCHI--BERGERON Gabriel",g:10,s:"c"},{n:"JANGAL Maxence",g:11,s:"a"},{n:"LAMOUR Mathilde",g:11,s:"b"},{n:"LAUDILLAY Timeo",g:11,s:"c"},{n:"MATHIS Paul",g:12,s:"a"},{n:"MONNIER Gaspard",g:12,s:"b"},{n:"PIERGA Baptiste",g:12,s:"c"},{n:"OLIERIC Guillaume",g:13,s:"a"},{n:"POTTEAU Baptiste",g:13,s:"b"},{n:"RIGAL Edgar",g:13,s:"c"},{n:"RINGUIER Thomas",g:14,s:"a"},{n:"SAINTONGE Louis",g:14,s:"b"},{n:"SLAMANI Edouard",g:14,s:"c"},{n:"TIENGOU DES ROYERIES Maxence",g:15,s:"a"},{n:"TOMETY Owen",g:15,s:"b"},{n:"TRAORE Sisse",g:15,s:"c"},{n:"VOITURIN Jules",g:16,s:"a"},{n:"ZINK Julien",g:16,s:"b"}];
var W=[{d:"2025-09-01",n:1},{d:"2025-09-08",n:2},{d:"2025-09-15",n:3},{d:"2025-09-22",n:4},{d:"2025-09-29",n:5},{d:"2025-10-06",n:6},{d:"2025-10-13",n:7,v:"Vacances Toussaint"},{d:"2025-11-03",n:8},{d:"2025-11-10",n:9},{d:"2025-11-17",n:10},{d:"2025-11-24",n:11},{d:"2025-12-01",n:12},{d:"2025-12-08",n:13},{d:"2025-12-15",n:14,v:"Vacances Noel"},{d:"2026-01-05",n:15,v:"Semaine SKI",ski:true},{d:"2026-01-12",n:16},{d:"2026-01-19",n:17},{d:"2026-01-26",n:18},{d:"2026-02-02",n:19},{d:"2026-02-09",n:20},{d:"2026-02-16",n:21,v:"Vacances hiver"},{d:"2026-03-09",n:22},{d:"2026-03-16",n:23},{d:"2026-03-23",n:24},{d:"2026-03-30",n:25},{d:"2026-04-06",n:26},{d:"2026-04-13",n:27,v:"Vacances printemps"},{d:"2026-05-04",n:28},{d:"2026-05-11",n:29},{d:"2026-05-18",n:30},{d:"2026-05-25",n:31},{d:"2026-06-01",n:32}];
var mS=[{j:"lundi",h:"16h-17h",p:"M. Jondreville",r:"K302"},{j:"lundi",h:"17h-18h",p:"M. Jondreville",r:"K302"},{j:"lundi",h:"18h-19h",p:"M. Gibaud",r:"K219"},{j:"mardi",h:"10h25-11h25",p:"M. Sarfati",r:"K12"},{j:"mardi",h:"11h25-12h25",p:"M. Sarfati",r:"K12"},{j:"mardi",h:"16h30-17h30",p:"M. Gibaud",r:"K218"},{j:"mardi",h:"17h30-18h30",p:"M. Gibaud",r:"K218"},{j:"mercredi",h:"17h-18h",p:"M. Gibaud",r:"K219"}];
var pS=[{j:"lundi",h:"16h-17h",p:"Mme Crosnier",r:"K301"},{j:"lundi",h:"17h-18h",p:"Mme Crosnier",r:"K301"},{j:"mardi",h:"10h25-11h25",p:"M. Pohon",r:"K07"},{j:"mardi",h:"11h25-12h25",p:"M. Pohon",r:"K07"},{j:"mardi",h:"16h30-17h30",p:"M. Mezenge",r:"labo"},{j:"mardi",h:"17h30-18h30",p:"M. Mezenge",r:"labo"},{j:"mercredi",h:"17h-18h",p:"M. Causse",r:"L129"},{j:"mercredi",h:"18h-19h",p:"M. Causse",r:"L129"}];
var sS=[{j:"lundi",h:"16h-17h",p:"M. Onillon",r:"K14"},{j:"lundi",h:"17h-18h",p:"M. Onillon",r:"K14"},{j:"lundi",h:"18h-19h",p:"M. Menard",r:"K12"},{j:"mardi",h:"18h-19h",p:"M. Menard",r:"K12"},{j:"mercredi",h:"17h-18h",p:"M. Onillon",r:"K12"},{j:"mercredi",h:"18h-19h",p:"M. Onillon",r:"K12"},{j:"jeudi",h:"16h30-17h30",p:"M. Houot",r:"K16"},{j:"jeudi",h:"17h30-18h30",p:"M. Houot",r:"K16"}];
var aS=[{j:"mardi",h:"10h30-11h30",p:"Mme Guillier",r:"K304"},{j:"mardi",h:"11h30-12h30",p:"Mme Guillier",r:"K304"},{j:"mardi",h:"12h30-13h30",p:"Mme Guillier",r:"K304"},{j:"mardi",h:"14h30-15h30",p:"Mme Guillier",r:"K304"},{j:"mardi",h:"15h30-16h30",p:"Mme Guillier",r:"K304"},{j:"mardi",h:"18h-19h",p:"Mme Gruber-Magitot",r:"K301"},{j:"jeudi",h:"17h-18h",p:"M. Babadjanian",r:"L203"},{j:"jeudi",h:"18h-19h",p:"M. Babadjanian",r:"L203"}];
var frS=[{j:"mardi",h:"10h30-11h",p:"Mme Sangouard",r:"K305"},{j:"mardi",h:"10h30-11h30",p:"Mme Sangouard",r:"K305"},{j:"mardi",h:"11h-12h",p:"Mme Sangouard",r:"K305"},{j:"mardi",h:"11h30-12h30",p:"Mme Sangouard",r:"K305"},{j:"mardi",h:"12h-13h",p:"Mme Sangouard",r:"K305"},{j:"mardi",h:"12h30-13h30",p:"Mme Sangouard",r:"K305"},{j:"mardi",h:"13h30-14h30",p:"Mme Sangouard",r:"K305"},{j:"mardi",h:"14h-15h",p:"Mme Sangouard",r:"K305"},{j:"mardi",h:"14h30-15h30",p:"Mme Sangouard",r:"K305"},{j:"mercredi",h:"17h-17h30",p:"Mme Quennedey",r:"K105"},{j:"mercredi",h:"17h-18h",p:"Mme Quennedey",r:"K105"},{j:"mercredi",h:"17h30-18h30",p:"Mme Quennedey",r:"K105"},{j:"mercredi",h:"18h-19h",p:"Mme Quennedey",r:"K105"},{j:"jeudi",h:"17h-17h30",p:"Mme Sangouard",r:"K305"},{j:"jeudi",h:"17h-18h",p:"Mme Sangouard",r:"K305"},{j:"jeudi",h:"17h30-18h30",p:"Mme Sangouard",r:"K305"},{j:"jeudi",h:"18h-19h",p:"Mme Sangouard",r:"K305"}];
var mD={4:[[4],[6],[10],[2],[16],[12],[8],[14]],5:[[1],[5],[7],[15],[9],[11],[3],[13]],6:[[10],[12],[2],[16],[4],[6],[14],[8]],7:[[15],[9],[3],[7],[11],[13],[1],[5]],8:[[2],[8],[4],[6],[14],[10],[12],[16]],9:[[5],[7],[13],[1],[11],[9],[15],[3]],10:[[12],[14],[2],[4],[10],[16],[6],[8]],11:[[15],[11],[3],[13],[1],[9],[5],[7]],12:[[6],[4],[16],[12],[2],[14],[8],[10]],13:[[3],[7],[9],[5],[13],[15],[1],[11]],14:[[16],[14],[4],[8],[6],[10],[2],[12]],16:[[11],[9],[1],[13],[7],[15],[3],[5]],17:[[8],[2],[14],[6],[10],[4],[16],[12]],18:[[3],[7],[15],[13],[9],[1],[11],[5]],19:[[14],[10],[4],[12],[2],[16],[6],[8]],20:[[13],[11],[5],[3],[1],[7],[9],[15]],21:[[6],[4],[10],[8],[14],[2],[16],[12]],22:[[3],[7],[1],[15],[5],[9],[13],[11]],23:[[10],[16],[8],[2],[12],[14],[6],[4]],24:[[15],[9],[3],[7],[13],[1],[11],[5]],25:[[8],[6],[10],[16],[12],[4],[14],[2]],26:[[5],[1],[13],[3],[11],[7],[9],[15]],27:[[12],[16],[2],[6],[8],[10],[4],[14]],28:[[11],[15],[1],[7],[5],[9],[13],[3]],29:[[2],[6],[12],[4],[10],[16],[8],[14]],30:[[5],[1],[7],[15],[3],[9],[11],[13]],31:[[14],[16],[6],[10],[2],[12],[8],[4]],32:[[9],[13],[3],[5],[11],[15],[7],[1]]};
var pD={4:[[8],[4],[16],[2],[14],[6],[10],[12]],5:[[3],[7],[9],[15],[1],[5],[11],[13]],6:[[14],[10],[4],[16],[12],[8],[6],[2]],7:[[13],[15],[11],[7],[1],[9],[3],[5]],8:[[4],[6],[14],[8],[2],[10],[12],[16]],9:[[3],[5],[11],[1],[7],[13],[15],[9]],10:[[16],[12],[10],[4],[6],[8],[14],[2]],11:[[9],[15],[1],[13],[5],[11],[3],[7]],12:[[8],[6],[2],[12],[4],[14],[16],[10]],13:[[1],[3],[13],[5],[9],[15],[7],[11]],14:[[10],[16],[6],[14],[2],[12],[4],[8]],16:[[9],[11],[7],[13],[3],[15],[1],[5]],17:[[4],[8],[10],[6],[14],[12],[2],[16]],18:[[5],[1],[9],[13],[11],[3],[15],[7]],19:[[16],[14],[2],[12],[4],[8],[10],[6]],20:[[11],[13],[1],[3],[9],[7],[5],[15]],21:[[2],[6],[14],[8],[10],[12],[16],[4]],22:[[1],[3],[5],[15],[13],[7],[9],[11]],23:[[14],[10],[12],[2],[16],[8],[6],[4]],24:[[11],[15],[13],[7],[3],[5],[1],[9]],25:[[6],[2],[12],[16],[8],[4],[10],[14]],26:[[7],[5],[11],[3],[9],[1],[13],[15]],27:[[10],[12],[8],[6],[2],[16],[4],[14]],28:[[13],[11],[5],[7],[15],[3],[1],[9]],29:[[8],[2],[10],[4],[6],[14],[16],[12]],30:[[7],[5],[3],[15],[1],[9],[11],[13]],31:[[12],[14],[2],[10],[16],[6],[8],[4]],32:[[13],[9],[11],[5],[7],[15],[3],[1]]};
var siD={4:[[1],[3],[13],[15],[9],[11],[5],[7]],5:[[2],[4],[14],[16],[10],[12],[6],[8]],6:[[13],[15],[9],[11],[5],[7],[1],[3]],7:[[14],[16],[10],[12],[6],[8],[2],[4]],8:[[1],[3],[5],[7],[9],[11],[13],[15]],9:[[2],[4],[6],[8],[10],[12],[14],[16]],10:[[13],[15],[1],[3],[5],[7],[9],[11]],11:[[14],[16],[2],[4],[6],[8],[10],[12]],12:[[1],[3],[13],[15],[9],[11],[5],[7]],13:[[2],[4],[14],[16],[10],[12],[6],[8]],14:[[13],[15],[9],[11],[5],[7],[1],[3]],16:[[14],[16],[10],[12],[6],[8],[2],[4]],17:[[1],[3],[5],[7],[9],[11],[13],[15]],18:[[2],[4],[6],[8],[10],[12],[14],[16]],19:[[13],[15],[1],[3],[5],[7],[9],[11]],20:[[14],[16],[2],[4],[6],[8],[10],[12]],21:[[1],[3],[13],[15],[9],[11],[5],[7]],22:[[2],[4],[14],[16],[10],[12],[6],[8]],23:[[13],[15],[9],[11],[5],[7],[1],[3]],24:[[14],[16],[10],[12],[6],[8],[2],[4]],25:[[1],[3],[5],[7],[9],[11],[13],[15]],26:[[2],[4],[6],[8],[10],[12],[14],[16]],27:[[13],[15],[1],[3],[5],[7],[9],[11]],28:[[14],[16],[2],[4],[6],[8],[10],[12]],29:[[1],[3],[13],[15],[9],[11],[5],[7]],30:[[2],[4],[14],[16],[10],[12],[6],[8]],31:[[13],[15],[9],[11],[7],[5],[1],[3]],32:[[14],[16],[10],[12],[6],[8],[2],[4]]};
var aD={4:[[1],[3],[9],[7],[5],[11],[13],[15]],5:[[6],[8],[14],[4],[2],[12],[10],[16]],6:[[3],[9],[1],[13],[11],[5],[15],[7]],7:[[4],[12],[16],[10],[14],[2],[8],[6]],8:[[7],[13],[15],[5],[9],[1],[3],[11]],9:[[12],[16],[4],[6],[10],[14],[2],[8]],10:[[9],[1],[3],[15],[5],[11],[7],[13]],11:[[8],[14],[6],[12],[10],[16],[2],[4]],12:[[1],[3],[9],[7],[11],[5],[13],[15]],13:[[16],[4],[12],[2],[6],[8],[10],[14]],14:[[13],[15],[7],[11],[1],[3],[9],[5]],16:[[4],[12],[16],[2],[14],[10],[8],[6]],17:[[7],[9],[1],[11],[15],[13],[3],[5]],18:[[14],[6],[8],[16],[2],[4],[12],[10]],19:[[9],[1],[3],[15],[11],[7],[5],[13]],20:[[12],[16],[4],[14],[10],[6],[8],[2]],21:[[15],[7],[13],[11],[3],[5],[1],[9]],22:[[16],[4],[12],[10],[6],[8],[2],[14]],23:[[1],[3],[9],[7],[5],[13],[11],[15]],24:[[6],[8],[14],[4],[10],[2],[12],[16]],25:[[3],[9],[1],[13],[11],[15],[5],[7]],26:[[10],[4],[16],[12],[2],[14],[8],[6]],27:[[15],[7],[13],[11],[1],[9],[3],[5]],28:[[16],[12],[4],[2],[8],[10],[6],[14]],29:[[1],[11],[3],[15],[5],[7],[9],[13]],30:[[8],[14],[6],[16],[10],[2],[4],[12]],31:[[9],[1],[3],[13],[11],[5],[7],[15]],32:[[12],[4],[16],[2],[6],[10],[14],[8]]};
var frD={3:["","","","","","","","","","","","","","5a","5b","5c","11a"],4:["","","","","","","","","","","","","","2a","2b","2c","14a"],5:["","","","","","","","","","","","","","11b","11c","13a","13b"],6:["","","","","","","","","","","","","","14b","14c","4a","4b"],7:["","","","","","","","","","","","","","13c","15a","15b","15c"],8:["","","","","","","","","","","","","","4c","16a","16b",""],9:["","","","","","","","","","","","","","3a","3b","3c","1a"],10:["","","","","","","","","","","","","","6a","6b","6c","8a"],11:["","","","","","","","","","","","","","1b","1c","9a","9b"],12:["","","","","","","","","","","","","","8b","8c","12a","12b"],13:["","","","","","","","","","","","","","9c","7a","7b","7c"],14:["","","","","","","","","","","","","","12c","10a","10b","10c"],16:["","","","","","","","","","2b","2c","2a","5a","","","",""],17:["","","","","","","","","","11a","11b","5b","5c","","","",""],18:["","","","","","","","","","14a","14b","14c","11c","","","",""],19:["","","","","","","","","","15a","15b","15c","13a","","","",""],20:["","","","","","","","","","13b","13c","16a","16b","","","",""],21:["","","","","","","","","","4b","4c","3a","","","","",""],22:["","","","","","","","","","3b","3c","4a","1b","","","",""],23:["","","","","","","","","","1a","1c","8c","6a","","","",""],24:["","","","","","","","","","8a","8b","7a","6b","","","",""],25:["","","","","","","","","","6c","7b","7c","10a","2c","2a","2b","5a"],26:["","","","","","","","","","9a","9b","9c","10b","5b","5c","11a","11b"],27:["13a","13b","13c","15a","15b","15c","","","","10c","12a","12b","12c","11c","14a","14b","14c"],28:["4a","4b","4c","16a","16b","","","","","","","","","","","",""],29:["3c","3a","3b","1a","1b","1c","","","","","","","","","","",""],30:["6b","6c","6a","8a","8b","8c","","","","","","","","","","",""],31:["","","","9b","9c","9a","7a","7b","7c","","","","","","","",""],32:["","","","12a","12b","12c","10a","10b","10c","","","","","","","",""]};
var dsD={2:"Maths",3:"Anglais",4:"Physique",5:"SI",6:"Maths",7:"Francais",8:"Physique",9:"SI",10:"Maths",11:"Anglais+Info",12:"Physique",13:"SI",14:"Maths",16:"Francais",17:"Physique",18:"SI",19:"Maths",20:"Anglais+Info",21:"Physique",22:"SI",23:"Maths",24:"Physique",25:"Francais",26:"SI",27:"Maths",30:"Physique",31:"SI",32:"Info"};
var tpInfoA={1:[9,10,14,15],2:[1,2,3,4],3:[1,2,3,7],4:[9,13,14,16],5:[9,10,11,14],6:[1,3,4,6],7:[1,6,7,8],8:[10,13,14,15],9:[11,12,15,16],10:[1,3,5,6],11:[1,2,3,5],12:[9,10,12,14],13:[9,13,14,15],14:[2,6,7,8],16:[4,6,7,8],17:[9,13,14,15],18:[9,10,11,16],19:[1,2,3,8],20:[1,2,3,7],21:[9,10,13,14],22:[9,12,14,16],23:[4,5,6,7],24:[1,3,4,8],25:[10,11,13,14,15],26:[9,10,11,14],27:[1,2,3,7],28:[4,5,6,8],29:[12,13,15,16],30:[9,10,13,16],32:[1,2,3,5]};
var tpInfoB={1:[6,7,8,13],2:[5,11,12,16],3:[4,5,11,12],4:[6,8,10,15],5:[5,12,13,16],6:[2,7,8,15],7:[2,3,5,9],8:[4,11,12,16],10:[2,8,13,14],11:[4,7,11,16],12:[6,8,13,15],13:[1,3,10,11],14:[4,5,12,16],16:[1,5,10,11],17:[2,3,12,16],18:[4,5,12,15],19:[6,7,13,14],20:[6,8,11,15],21:[4,5,12,16],22:[1,2,3,11],23:[8,10,13,15],24:[5,11,12,16],25:[2,6,7,10],26:[6,8,13,15],27:[4,5,12,16],28:[1,3,10,11],29:[2,7,9,14],30:[4,7,11,12],31:[6,8,14,15]};
var combi1={1:[1,2,3,9,10],2:[6,7,8,13,14,15],3:[6,7,8,13,14,15],4:[4,5,11,12],5:[1,2,3,10],6:[5,11,12],7:[6,8,13,14,15],8:[1,2,3,9,10],9:[2,3,9,10],10:[5,11,12,16],11:[2,3,9,10],12:[4,5,11,16],13:[6,7,8,14,15],14:[1,2,3,9,10],16:[6,8,14,15],17:[8,13,14,15],18:[1,2,3,10],19:[4,5,11,16],20:[2,9,10],21:[1,2,3,9,10],22:[6,7,8,13,14],23:[4,5,11,16],24:[1,2,3,9,10],25:[4,5,11],26:[1,2,9],27:[1,2,3,9,10],28:[6,8,13,14,15],29:[5,12,16],30:[1,2,9,10],31:[4,5,11,12,16],32:[6,7,8,13,14,15]};
var combi2={1:[4,5,11,12,16],2:[1,2,3,9,10],3:[1,2,3,9,10],4:[6,7,8,13,15],5:[4,5,12,16],6:[7,8,13,15],7:[2,3,9,10],8:[4,5,11,12,16],9:[6,8,13,14,15],10:[7,8,13,14,15],11:[4,11,12,16],12:[6,7,8,13,15],13:[1,2,3,10],14:[4,5,11,12,16],16:[1,2,10],17:[11,12,16],18:[4,5,12,16],19:[6,7,13,14,15],20:[6,8,14,15],21:[4,5,11,12,16],22:[1,2,3,10],23:[6,7,8,13,15],24:[4,5,11,12,16],25:[6,7,13,15],26:[6,8,13,15],27:[4,5,11,12,16],28:[1,2,3,10],29:[7,8,14,15],30:[4,11,12,16],31:[6,7,8,13,14,15],32:[1,2,3,9,10]};
var combi3={1:[6,7,8,13,14,15],2:[4,5,11,12,16],3:[4,5,11,12,16],4:[1,2,3,9],5:[6,7,8,14,15],6:[1,3,9],7:[4,11,12,16],8:[6,7,8,13,14,15],9:[4,11,12,16],10:[1,3,9,10],11:[6,8,13,14,15],12:[1,2,3,9],13:[4,5,12,16],14:[6,7,8,13,14,15],16:[4,12,16],17:[1,9,10],18:[6,7,8,13,14],19:[1,2,3,9],20:[4,12,16],21:[6,7,8,13,14,15],22:[4,5,12,16],23:[1,2,3,9],24:[6,7,8,13,14,15],25:[1,3,9],26:[4,11,16],27:[6,7,8,13,14,15],28:[4,5,12,16],29:[1,3,10],30:[6,8,13,14,15],31:[1,2,3,9,10],32:[4,5,11,12,16]};
var combi4={4:[16],5:[9],6:[4,16],7:[7],9:[1],10:[4],11:[1],12:[12],13:[13],16:[7,13],17:[6,7],18:[9],19:[12],20:[1,3],22:[15],23:[12],25:[12,16],26:[3,10],28:[7],29:[4,11],30:[3]};
var combi5={4:[14],5:[11],6:[6,14],7:[1],9:[7],10:[6],11:[5],12:[14],13:[9],16:[3,9],17:[4,5],18:[11],19:[8],20:[7,13],22:[9],23:[14],25:[8,14],26:[7,14],28:[9],29:[6,13],30:[5]};
var combi6={4:[10],5:[13],6:[2,10],7:[5],9:[5],10:[2],11:[7],12:[10],13:[11],16:[5,11],17:[2,3],18:[15],19:[10],20:[5,11],22:[11],23:[10],25:[2,10],26:[5,12],28:[11],29:[2,9],30:[7]};
var st=null,wI=0,th="dark",curTab="colles",curGradeSub="";
var grades={Maths:[],Physique:[],SI:[],Anglais:[],Francais:[],Info:[]};
var memos={};
function init(){loadData();renderStudents();renderTabs();renderContacts();bindEvents();if(st)showDash();goToday();}
function loadData(){try{var cs=localStorage.getItem("cs");var ct=localStorage.getItem("ct");var gr=localStorage.getItem("grades");var me=localStorage.getItem("memos");if(cs){var d=JSON.parse(cs);for(var i=0;i<S.length;i++){if(S[i].n===d.n){st=S[i];break;}}}if(ct){th=ct;applyTheme();}if(gr)grades=JSON.parse(gr);if(me)memos=JSON.parse(me);}catch(e){}}
function saveData(){if(st)localStorage.setItem("cs",JSON.stringify({n:st.n}));localStorage.setItem("ct",th);localStorage.setItem("grades",JSON.stringify(grades));localStorage.setItem("memos",JSON.stringify(memos));}
function bindEvents(){document.getElementById("searchInput").oninput=function(){renderStudents(this.value);};document.getElementById("themeBtn").onclick=toggleTheme;document.getElementById("userBtn").onclick=showWelcome;document.getElementById("logoutBtn").onclick=logout;document.getElementById("prevBtn").onclick=function(){changeWeek(-1);};document.getElementById("todayBtn").onclick=goToday;document.getElementById("nextBtn").onclick=function(){changeWeek(1);};document.getElementById("notifBtn").onclick=toggleNotif;document.getElementById("exportBtn").onclick=exportCal;document.getElementById("compareBtn").onclick=compareSched;document.getElementById("memoArea").oninput=saveMemo;document.getElementById("closeModal").onclick=closeGradeModal;document.getElementById("addGradeBtn").onclick=addGrade;document.getElementById("gradeModal").onclick=function(e){if(e.target.id==="gradeModal")closeGradeModal();};}
function toggleTheme(){th=th==="dark"?"light":"dark";applyTheme();saveData();}
function applyTheme(){document.documentElement.setAttribute("data-theme",th);document.getElementById("themeBtn").innerHTML=th==="dark"?"&#9728;":"&#127769;";}
function renderStudents(f){f=f||"";var list=document.getElementById("studentList");var html="";for(var i=0;i<S.length;i++){var s=S[i];if(s.n.toLowerCase().indexOf(f.toLowerCase())!==-1){html+='<div class="sti" onclick="selectStudent('+i+')"><div class="sta">'+getInit(s.n)+'</div><div><div class="stn">'+s.n+'</div><div class="stg">Groupe '+s.g+s.s+'</div></div></div>';}}list.innerHTML=html;}
function getInit(name){var p=name.split(" ");if(p.length>=2)return(p[0][0]+p[p.length-1][0]).toUpperCase();return name.slice(0,2).toUpperCase();}
function selectStudent(idx){st=S[idx];saveData();showDash();}
function showDash(){document.getElementById("welcome").classList.add("h");document.getElementById("dashboard").classList.add("a");document.getElementById("userBtn").style.display="flex";document.getElementById("logoutBtn").style.display="block";updateUserInfo();updateDisplay();populateCompare();}
function showWelcome(){document.getElementById("welcome").classList.remove("h");document.getElementById("dashboard").classList.remove("a");}
function updateUserInfo(){document.getElementById("userAvatar").textContent=getInit(st.n);var p=st.n.split(" ");document.getElementById("userName").textContent=p[p.length-1];document.getElementById("userGroup").textContent="Groupe "+st.g+st.s;}
function logout(){st=null;localStorage.removeItem("cs");document.getElementById("welcome").classList.remove("h");document.getElementById("dashboard").classList.remove("a");document.getElementById("userBtn").style.display="none";document.getElementById("logoutBtn").style.display="none";}
function goToday(){var now=new Date();var closest=0,minDiff=Infinity;for(var i=0;i<W.length;i++){var diff=Math.abs(now-new Date(W[i].d));if(diff<minDiff){minDiff=diff;closest=i;}}wI=closest;updateDisplay();}
function changeWeek(dir){wI=(wI+dir+W.length)%W.length;updateDisplay();}
function updateDisplay(){updateWeekInfo();updateProg();if(st){renderColles();renderEDT();renderStats();loadMemo();}}
function updateProg(){var wn=W[wI].n;var pct=Math.round((wn/32)*100);document.getElementById("progText").textContent="Semaine "+wn+"/32";document.getElementById("progPct").textContent=pct+"%";document.getElementById("progFill").style.width=pct+"%";}
function updateWeekInfo(){var w=W[wI];var start=new Date(w.d);var end=new Date(start);end.setDate(end.getDate()+6);document.getElementById("weekTitle").textContent="Semaine "+w.n;document.getElementById("weekDates").textContent="Du "+start.toLocaleDateString("fr-FR",{day:"numeric",month:"long"})+" au "+end.toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"});var vb=document.getElementById("vacBanner");if(w.v){var icon=w.ski?"&#9975;":"&#127958;";vb.innerHTML='<div class="vb"><h3>'+icon+" "+w.v+"</h3><p>"+(w.ski?"Bonne glisse !":"Profite bien !")+"</p></div>";}else{vb.innerHTML="";}var dsb=document.getElementById("dsBanner");var ds=dsD[w.n];if(ds&&!w.ski){dsb.innerHTML='<div class="dsb"><div class="dsbi">&#128221;</div><div><h3>DS Vendredi 13h-17h</h3><p>'+ds+" - L410-L413</p></div></div>";}else{dsb.innerHTML="";}}
function renderTabs(){var tabs=[{id:"colles",l:"&#128218; Colles"},{id:"edt",l:"&#128197; EDT"},{id:"stats",l:"&#128202; Stats"},{id:"compare",l:"&#128101; Dispo"},{id:"notes",l:"&#128221; Memos"},{id:"contact",l:"&#128231; Contacts"}];var html="";for(var i=0;i<tabs.length;i++){var t=tabs[i];html+='<button class="tab'+(t.id==="colles"?" a":"")+'" onclick="showTab(\''+t.id+'\')">'+t.l+'</button>';}document.getElementById("tabs").innerHTML=html;}
function showTab(id){curTab=id;var tabs=document.querySelectorAll(".tab");for(var i=0;i<tabs.length;i++){tabs[i].className="tab";}event.target.classList.add("a");var contents=document.querySelectorAll(".tc");for(var j=0;j<contents.length;j++){contents[j].classList.remove("a");}document.getElementById(id+"Content").classList.add("a");}
function findColles(student,wn){var result=[];var g=student.g;var sg=student.g+student.s;var subjects=[[mD,mS,"Maths","ma","&#8721;"],[pD,pS,"Physique","ph","&#9883;"],[siD,sS,"SI","si","&#9881;"],[aD,aS,"Anglais","an","&#127468;&#127463;"]];for(var i=0;i<subjects.length;i++){var subj=subjects[i];var data=subj[0],slots=subj[1],name=subj[2],cl=subj[3],icon=subj[4];if(data[wn]){for(var j=0;j<data[wn].length;j++){var groups=data[wn][j];if(groups&&groups.indexOf(g)!==-1){var slot=slots[j];result.push({m:name,cl:cl,ic:icon,j:slot.j,h:slot.h,p:slot.p,r:slot.r});}}}}if(frD[wn]){for(var k=0;k<frD[wn].length;k++){if(frD[wn][k]===sg){var frSlot=frS[k];result.push({m:"Francais",cl:"fr",ic:"&#128214;",j:frSlot.j,h:frSlot.h,p:frSlot.p,r:frSlot.r});}}}return result;}
function cap(s){return s.charAt(0).toUpperCase()+s.slice(1);}
function renderColles(){var grid=document.getElementById("colleGrid");var wn=W[wI].n;var colles=findColles(st,wn);if(colles.length===0){grid.innerHTML='<div class="nc"><div class="nci">&#127881;</div><p>Pas de colle cette semaine !</p></div>';return;}var html="";for(var i=0;i<colles.length;i++){var c=colles[i];html+='<div class="cc '+c.cl+'"><div class="cs"><div class="csi">'+c.ic+'</div>'+c.m+'</div><div class="cd"><div class="cdi"><div class="cdic">&#128197;</div><span>'+cap(c.j)+'</span></div><div class="cdi"><div class="cdic">&#128336;</div><span>'+c.h+'</span></div><div class="cdi"><div class="cdic">&#128205;</div><span>Salle '+c.r+'</span></div><div class="cdi"><div class="cdic">&#128100;</div><span>'+c.p+'</span></div></div></div>';}grid.innerHTML=html;}
function getTodayIdx(){var now=new Date();var wStart=new Date(W[wI].d);var diff=Math.floor((now-wStart)/(1000*60*60*24));return(diff>=0&&diff<5)?diff:-1;}
function renderEDT(){var wn=W[wI].n;var g=st.g;var w=W[wI];var grid=document.getElementById("edtGrid");if(w.ski){grid.innerHTML='<div style="text-align:center;padding:60px;color:var(--txt3)"><div style="font-size:4rem;margin-bottom:20px">&#9975;</div><h3>Semaine de SKI</h3><p>Pas de cours !</p></div>';return;}var colles=findColles(st,wn);var items={l:[],ma:[],me:[],j:[],v:[]};items.l.push({n:"Physique",i:"Mme Crosnier - K12",c:"ph",start:0,dur:110});items.l.push({n:"SI",i:"M. Onillon - K12",c:"si",start:130,dur:110});items.l.push({n:"TIPE",i:"Labo/K12",c:"ti",start:245,dur:55});var tdaSiL=(wn%2===1)?(g<=8):(g>8);var hasInfoA=tpInfoA[wn]&&tpInfoA[wn].indexOf(g)!==-1;var hasInfoB=tpInfoB[wn]&&tpInfoB[wn].indexOf(g)!==-1;if(hasInfoA)items.l.push({n:"TP Info A",i:"K301",c:"in",start:360,dur:110});else if(tdaSiL)items.l.push({n:"TDA SI",i:"M. Menard - K12",c:"si",start:360,dur:110});if(!tdaSiL)items.l.push({n:"TDB SI",i:"M. Menard - K12",c:"si",start:485,dur:110});items.ma.push({n:"Maths",i:"M. Sarfati - K12",c:"ma",start:0,dur:140});var mc=0;if(combi1[wn]&&combi1[wn].indexOf(g)!==-1)mc=1;else if(combi2[wn]&&combi2[wn].indexOf(g)!==-1)mc=2;else if(combi3[wn]&&combi3[wn].indexOf(g)!==-1)mc=3;else if(combi4[wn]&&combi4[wn].indexOf(g)!==-1)mc=4;else if(combi5[wn]&&combi5[wn].indexOf(g)!==-1)mc=5;else if(combi6[wn]&&combi6[wn].indexOf(g)!==-1)mc=6;if(mc===1){items.ma.push({n:"TPA Physique",i:"Labo",c:"ph",start:155,dur:110});items.ma.push({n:"TPA SI",i:"K16",c:"si",start:300,dur:140});}else if(mc===2){items.ma.push({n:"TPB SI",i:"K16",c:"si",start:155,dur:140});if(hasInfoB)items.ma.push({n:"TP Info B",i:"K12",c:"in",start:330,dur:110});items.ma.push({n:"TPB Physique",i:"Labo",c:"ph",start:450,dur:110});}else if(mc===3){items.ma.push({n:"TPC Physique",i:"Labo",c:"ph",start:330,dur:110});items.ma.push({n:"TPC SI",i:"K16",c:"si",start:450,dur:140});}else if(mc===4){items.ma.push({n:"TPB SI",i:"K16",c:"si",start:155,dur:140});items.ma.push({n:"TPC Physique",i:"Labo",c:"ph",start:330,dur:110});}else if(mc===5){items.ma.push({n:"TPA Physique",i:"Labo",c:"ph",start:155,dur:110});if(hasInfoB)items.ma.push({n:"TP Info B",i:"K12",c:"in",start:330,dur:110});items.ma.push({n:"TPC SI",i:"K16",c:"si",start:450,dur:140});}else if(mc===6){if(hasInfoB)items.ma.push({n:"TP Info B",i:"K12",c:"in",start:330,dur:110});items.ma.push({n:"TPA SI",i:"K16",c:"si",start:300,dur:140});items.ma.push({n:"TPB Physique",i:"Labo",c:"ph",start:450,dur:110});}items.me.push({n:"Francais",i:"Mme Sangouard - K12",c:"fr",start:0,dur:110});items.me.push({n:"Maths",i:"M. Sarfati - K12",c:"ma",start:130,dur:110});items.me.push({n:"TD SI",i:"M. Onillon - K12",c:"si",start:300,dur:110});items.me.push({n:"TD Maths",i:"M. Sarfati - K301",c:"ma",start:425,dur:110});items.j.push({n:"Anglais",i:"Mme Guillier - K12",c:"an",start:0,dur:110});items.j.push({n:"Physique",i:"Mme Crosnier - K12",c:"ph",start:130,dur:110});items.j.push({n:"TD SI ratt.",i:"M. Onillon - K12",c:"si",start:275,dur:110});items.j.push({n:"TD Physique",i:"K07",c:"ph",start:395,dur:55});items.j.push({n:"TD Maths",i:"K07",c:"ma",start:450,dur:55});var vInfo=(wn%2===0);items.v.push({n:"Maths",i:"M. Sarfati - K12",c:"ma",start:0,dur:110});items.v.push({n:vInfo?"Info":"Physique",i:"K12",c:vInfo?"in":"ph",start:130,dur:110});var ds=dsD[wn];if(ds)items.v.push({n:"DS "+ds,i:"L410-L413",c:"ds",start:300,dur:240});var dayMap={lundi:0,mardi:1,mercredi:2,jeudi:3,vendredi:4};var dayKeys=["l","ma","me","j","v"];for(var ci=0;ci<colles.length;ci++){var co=colles[ci];var hm=co.h.match(/(\d+)h(\d*)/);if(hm){var st2=(parseInt(hm[1])-8)*60+(parseInt(hm[2])||0);var di=dayMap[co.j];if(di!==undefined)items[dayKeys[di]].push({n:"Colle "+co.m,i:co.p+" - "+co.r,c:"co",start:st2,dur:60});}}var rowH=40,totalH=11*rowH;var todayIdx=getTodayIdx();var days=["Lundi","Mardi","Mercredi","Jeudi","Vendredi"];var html='<table><tr><th style="width:80px"></th>';for(var di2=0;di2<days.length;di2++){html+='<th class="'+(di2===todayIdx?"today":"")+'">'+days[di2]+(di2===todayIdx?" &#128205;":"")+"</th>";}html+='</tr><tr><td class="time" style="vertical-align:top;padding-top:8px">';for(var h=8;h<=18;h++)html+='<div style="height:'+rowH+'px;line-height:'+rowH+'px">'+h+'h</div>';html+="</td>";for(var dk=0;dk<dayKeys.length;dk++){var key=dayKeys[dk];html+='<td class="'+(dk===todayIdx?"today":"")+'" style="height:'+totalH+'px;position:relative">';for(var it=0;it<items[key].length;it++){var item=items[key][it];var top=item.start*rowH/60;var height=item.dur*rowH/60;html+='<div class="edt-item '+item.c+'" style="top:'+top+'px;height:'+height+'px"><div class="n">'+item.n+'</div><div class="i">'+item.i+'</div></div>';}html+="</td>";}html+="</tr></table>";grid.innerHTML=html;}
function renderContacts(){var contacts=[{cat:"&#128208; Maths",cl:"ma",list:[{n:"M. Sarfati",e:"dan.sarfati@gmail.com"},{n:"M. Jondreville",e:"david.jondreville@gmail.com"},{n:"M. Gibaud",e:"gibaudsylvain@gmail.com"}]},{cat:"&#9883; Physique",cl:"ph",list:[{n:"Mme Crosnier",e:"cecile.crosnier.de.bellaistre@gmail.com"},{n:"M. Mezenge",e:"profmezenge@gmail.com"},{n:"M. Pohon",e:"yannick_pohon@hotmail.com"}]},{cat:"&#9881; SI",cl:"si",list:[{n:"M. Onillon",e:"julien.onillon@orange.fr"},{n:"M. Houot",e:"martinhouotpro@gmail.com"},{n:"M. Menard",e:"romainmenard@outlook.fr"}]},{cat:"&#127468;&#127463; Anglais",cl:"an",list:[{n:"Mme Guillier",e:"lguillier27@gmail.com"},{n:"Mme Gruber-Magitot",e:"cg15038@my.bristol.ac.uk"},{n:"M. Babadjanian",e:"mirabardi@gmail.com"}]},{cat:"&#128214; Francais",cl:"fr",list:[{n:"Mme Sangouard-Berdeaux",e:"celine.sangouard@ac-versailles.fr"},{n:"Mme Quennedey",e:"anne.quennedey@gmail.com"}]}];var html="";for(var i=0;i<contacts.length;i++){var cat=contacts[i];var icon=cat.cl==="ma"?"&#128208;":cat.cl==="ph"?"&#9883;":cat.cl==="si"?"&#9881;":cat.cl==="an"?"&#127468;&#127463;":"&#128214;";html+='<div class="contact-section"><h4>'+cat.cat+'</h4><div class="contact-grid">';for(var j=0;j<cat.list.length;j++){var p=cat.list[j];html+='<div class="contact-card"><div class="contact-avatar '+cat.cl+'">'+icon+'</div><div><div class="contact-name">'+p.n+'</div><div class="contact-email"><a href="mailto:'+p.e+'">'+p.e+'</a></div></div></div>';}html+="</div></div>";}document.getElementById("contactGrid").innerHTML=html;}
function renderStats(){var totalColles=0;for(var w=1;w<=32;w++)totalColles+=findColles(st,w).length;var futureColles=0;for(var i=wI;i<W.length;i++)futureColles+=findColles(st,W[i].n).length;function avg(subj){var g=grades[subj];if(!g.length)return"-";var s=0;for(var i=0;i<g.length;i++)s+=g[i].v;return(s/g.length).toFixed(2);}function totalAvg(){var s=0,c=0;for(var k in grades){for(var i=0;i<grades[k].length;i++){s+=grades[k][i].v;c++;}}return c?(s/c).toFixed(2)+"/20":"-";}document.getElementById("statsGrid").innerHTML='<div class="stat-card"><div class="stat-value">'+totalColles+'</div><div class="stat-label">Colles annee</div></div><div class="stat-card"><div class="stat-value">'+futureColles+'</div><div class="stat-label">Colles restantes</div></div><div class="stat-card"><div class="stat-value">'+totalAvg()+'</div><div class="stat-label">Moyenne generale</div></div><div class="stat-card"><div class="stat-value">'+W[wI].n+'/32</div><div class="stat-label">Progression</div></div>';var subjects=[{n:"Maths",ic:"&#128208;"},{n:"Physique",ic:"&#9883;"},{n:"SI",ic:"&#9881;"},{n:"Anglais",ic:"&#127468;&#127463;"},{n:"Francais",ic:"&#128214;"},{n:"Info",ic:"&#128187;"}];var ghtml="";for(var si=0;si<subjects.length;si++){var sub=subjects[si];var a=avg(sub.n);var col=a==="-"?"var(--txt3)":(parseFloat(a)>=10?"var(--green)":"var(--red)");ghtml+='<div class="grade-card"><div class="grade-header"><div class="grade-subject">'+sub.ic+" "+sub.n+'</div><div class="grade-avg" style="color:'+col+'">'+a+'</div></div><div class="grade-list">';for(var gi=0;gi<grades[sub.n].length;gi++){var gr=grades[sub.n][gi];ghtml+='<div class="grade-item"><span>'+gr.l+'</span><span>'+gr.v+'/20 <button style="background:none;border:none;color:var(--red);cursor:pointer" onclick="deleteGrade(\''+sub.n+'\','+gi+')">&times;</button></span></div>';}ghtml+='</div><button class="add-grade-btn" onclick="openGradeModal(\''+sub.n+'\')">+ Ajouter note</button></div>';}document.getElementById("gradesGrid").innerHTML=ghtml;}
function openGradeModal(subj){curGradeSub=subj;document.getElementById("gradeModal").classList.add("show");}
function closeGradeModal(){document.getElementById("gradeModal").classList.remove("show");document.getElementById("gradeLabel").value="";document.getElementById("gradeValue").value="";}
function addGrade(){var l=document.getElementById("gradeLabel").value.trim();var v=parseFloat(document.getElementById("gradeValue").value);if(!l||isNaN(v)||v<0||v>20){alert("Remplis correctement");return;}grades[curGradeSub].push({l:l,v:v});saveData();renderStats();closeGradeModal();}
function deleteGrade(subj,idx){grades[subj].splice(idx,1);saveData();renderStats();}
function loadMemo(){document.getElementById("memoArea").value=memos[W[wI].n]||"";}
function saveMemo(){memos[W[wI].n]=document.getElementById("memoArea").value;saveData();var saved=document.getElementById("memoSaved");saved.classList.add("show");setTimeout(function(){saved.classList.remove("show");},2000);}
function populateCompare(){var sel=document.getElementById("compareSelect");var html="";for(var i=0;i<S.length;i++){if(!st||S[i].n!==st.n){html+='<option value="'+i+'">'+S[i].n+" (G"+S[i].g+")</option>";}}sel.innerHTML=html;}
function compareSched(){var sel=document.getElementById("compareSelect");var selected=[];for(var i=0;i<sel.selectedOptions.length;i++){selected.push(S[parseInt(sel.selectedOptions[i].value)]);}if(!selected.length){alert("Selectionne au moins un camarade");return;}var wn=W[wI].n;var all=[st].concat(selected);var busy=[];for(var ai=0;ai<all.length;ai++){var slots=[];var fixed=[{d:0,s:0,e:110},{d:0,s:130,e:240},{d:0,s:245,e:300},{d:1,s:0,e:140},{d:2,s:0,e:110},{d:2,s:130,e:240},{d:2,s:300,e:410},{d:2,s:425,e:535},{d:3,s:0,e:110},{d:3,s:130,e:240},{d:3,s:275,e:385},{d:3,s:395,e:505},{d:4,s:0,e:110},{d:4,s:130,e:240}];slots=slots.concat(fixed);if(dsD[wn])slots.push({d:4,s:300,e:540});var colles=findColles(all[ai],wn);var dayMap={lundi:0,mardi:1,mercredi:2,jeudi:3,vendredi:4};for(var ci=0;ci<colles.length;ci++){var hm=colles[ci].h.match(/(\d+)h(\d*)/);if(hm){var st2=(parseInt(hm[1])-8)*60+(parseInt(hm[2])||0);slots.push({d:dayMap[colles[ci].j],s:st2,e:st2+60});}}busy.push(slots);}var days=["Lundi","Mardi","Mercredi","Jeudi","Vendredi"];var free=[];for(var d=0;d<5;d++){for(var h=8;h<19;h++){var start=(h-8)*60,end=start+60,ok=true;for(var bi=0;bi<busy.length&&ok;bi++){for(var si2=0;si2<busy[bi].length&&ok;si2++){var sl=busy[bi][si2];if(sl.d===d&&!(end<=sl.s||start>=sl.e))ok=false;}}if(ok)free.push({d:d,h:h});}}var grouped=[];var cur=null;for(var fi=0;fi<free.length;fi++){var f=free[fi];if(cur&&cur.d===f.d&&cur.eh===f.h){cur.eh=f.h+1;}else{if(cur)grouped.push(cur);cur={d:f.d,sh:f.h,eh:f.h+1};}}if(cur)grouped.push(cur);var res=document.getElementById("compareResult");res.style.display="block";if(!grouped.length){res.innerHTML='<p style="text-align:center;color:var(--txt3)">Aucun creneau libre</p>';return;}var names=[];for(var ni=0;ni<selected.length;ni++)names.push(selected[ni].n.split(" ").pop());var html='<h4 style="margin-bottom:12px">Creneaux libres avec '+names.join(", ")+'</h4><div class="free-slots">';for(var gi2=0;gi2<grouped.length;gi2++){var grp=grouped[gi2];html+='<div class="free-slot"><div class="day">'+days[grp.d]+'</div><div class="time">'+grp.sh+"h - "+grp.eh+"h</div></div>";}res.innerHTML=html+"</div>";}
function toggleNotif(){if(!("Notification" in window)){alert("Navigateur non compatible");return;}Notification.requestPermission().then(function(p){if(p==="granted"){new Notification("Rappels actives",{body:"Tu seras notifie avant tes colles"});}});}
function exportCal(){var wn=W[wI].n;var colles=findColles(st,wn);var wStart=new Date(W[wI].d);var dayMap={lundi:0,mardi:1,mercredi:2,jeudi:3,vendredi:4};var ics="BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Colloscope//FR\n";function fmt(d){return d.getFullYear()+String(d.getMonth()+1).padStart(2,"0")+String(d.getDate()).padStart(2,"0")+"T"+String(d.getHours()).padStart(2,"0")+String(d.getMinutes()).padStart(2,"0")+"00";}for(var i=0;i<colles.length;i++){var c=colles[i];var hm=c.h.match(/(\d+)h(\d*)-(\d+)h(\d*)/);if(!hm)continue;var d=new Date(wStart);d.setDate(d.getDate()+dayMap[c.j]);var ds=new Date(d);ds.setHours(parseInt(hm[1]),parseInt(hm[2])||0);var de=new Date(d);de.setHours(parseInt(hm[3]),parseInt(hm[4])||0);ics+="BEGIN:VEVENT\nDTSTART:"+fmt(ds)+"\nDTEND:"+fmt(de)+"\nSUMMARY:Colle "+c.m+"\nLOCATION:"+c.r+"\nEND:VEVENT\n";}var ds2=dsD[wn];if(ds2){var dv=new Date(wStart);dv.setDate(dv.getDate()+4);var dvs=new Date(dv);dvs.setHours(13,0);var dve=new Date(dv);dve.setHours(17,0);ics+="BEGIN:VEVENT\nDTSTART:"+fmt(dvs)+"\nDTEND:"+fmt(dve)+"\nSUMMARY:DS "+ds2+"\nLOCATION:L410\nEND:VEVENT\n";}ics+="END:VCALENDAR";var blob=new Blob([ics],{type:"text/calendar"});var url=URL.createObjectURL(blob);var a=document.createElement("a");a.href=url;a.download="colles-sem"+wn+".ics";a.click();URL.revokeObjectURL(url);}
init();
</script>
</body>
</html>
